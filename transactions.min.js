function youTubeResize(e,t){$("#"+e).width(t);var n=9*t/16;$("#"+e).height(n)}function showGauge(e,t,n,i,o){new JustGage({id:o,value:Math.round(i),min:Math.round(e),max:Math.round(t),title:"Obtenido",label:"quedan "+n+" días",symbol:"€",gaugeWidthScale:.2,levelColors:["#B51A41","#F59827","#AFE826"],titleMinFontSize:25})}function budgetSuccess(e){window.projectNeedsJson=JSON.parse(e.responseText),$.each(window.projectNeedsJson,function(e,t){$.each(t,function(e,t){if("totals"!=e&&(0!=t.totals.min||0!=t.totals.efect)){var n=$(".projectBudgetList"),i=$("<div/>").addClass("ui-div-top-item projectBudgetBox").appendTo(n);$("<h4/>").addClass("ui-h4-top-item").text(t.desig).appendTo(i),$("<p/>").addClass("ui-p-top-item-desc").text(t.descriptor).appendTo(i),$("<p/>").addClass("ui-p-top-item-cant").text("€ "+(parseInt(t.totals.min)+parseInt(t.totals.efect))).appendTo(i);$.each(t,function(e,t){if("totals"!=e&&"desig"!=e&&"descriptor"!=e&&(t.totals.min>0||t.totals.efect>0)){var n=$("<div/>").addClass("ui-div-item").appendTo(i);$("<h5/>").addClass("ui-h5-item").text(t.desig).appendTo(n),$("<p/>").addClass("ui-p-item-desc").text(t.descriptor).appendTo(n);if(0!=t.totals.min&&0!=t.totals.efect){$("<p/>").addClass("ui-p-item-cant").text("€ "+(parseInt(t.totals.efect)+parseInt(t.totals.min))).appendTo(n)}else if(0!=t.totals.efect){$("<p/>").addClass("ui-p-item-cant").text("€ "+t.totals.efect).appendTo(n)}else{$("<p/>").addClass("ui-p-item-cant").text("€ "+t.totals.min).appendTo(n)}$.each(t,function(e,t){if("totals"!=e&&"desig"!=e&&"descriptor"!=e&&"cant"!=e&&"uds"!=e&&"precio"!=e&&(t.totals.min>0||t.totals.efect>0)){var i=$("<div/>").addClass("ui-div-sub-item").appendTo(n);$("<h5/>").addClass("ui-h5-sub-item").text(t.desig).appendTo(i),$("<p/>").addClass("ui-p-sub-item-desc").text(t.descriptor).appendTo(i);if(t.totals.min>0){$("<p/>").addClass("ui-p-sub-item-cant").text("€ "+t.totals.min).appendTo(i)}else{$("<p/>").addClass("ui-p-sub-item-cant ui-p-red").text("€ "+t.totals.efect).appendTo(i)}}})}})}});var n=$(".projectBudgetListTotals"),i=$("<div/>").addClass("ui-div-item").appendTo(n),o=$("<h4/>").addClass("ui-header-item-sub").text("Subtotal:").appendTo(i),a=$("<p/>").addClass("ui-paragraph-item-sub").text("€ "+(Math.round(parseInt(t.totals.min))+Math.round(parseInt(t.totals.efect)))).appendTo(i);i=$("<div/>").addClass("ui-div-item").appendTo(n),o=$("<h4/>").addClass("ui-header-item-pre").text("Fondo de contingencia (1%):").appendTo(i),a=$("<p/>").addClass("ui-paragraph-item-pre").text("€ "+Math.round(.01*(Math.round(parseInt(t.totals.min))+Math.round(parseInt(t.totals.efect))))).appendTo(i),i=$("<div/>").addClass("ui-div-item").appendTo(n),o=$("<h4/>").addClass("ui-header-item").text("Total:").appendTo(i),a=$("<p/>").addClass("ui-paragraph-item").text("€ "+Math.round(1.01*(Math.round(parseInt(t.totals.min))+Math.round(parseInt(t.totals.efect))))).appendTo(i)})}function statsInit(){showGauge(0,window.crowdfundingStats.TOTALS.optimal,window.crowdfundingStats.TOTALS.daysleft,window.crowdfundingStats.TOTALS.totalincome,"perks-gauge1"),$("#cfStatsAchieved1").html(window.crowdfundingStats.TOTALS.totalincome),$("#cfStatsSupporters1").html(window.crowdfundingStats.TOTALS.solditems),$("#cfStatsNeeded1").html(parseInt(window.crowdfundingStats.TOTALS.optimal)),$("#cfStatsDaysLeft1").html(window.crowdfundingStats.TOTALS.daysleft);for(var e in window.crowdfundingStats)if("PERK"==e.substring(0,4)){window.crowdfundingStats[e];$("#div"+toTitleCase(e)+"customDonationAmount").val(window.crowdfundingStats[e].price),$("#span"+toTitleCase(e)+"Price").html(window.crowdfundingStats[e].price),$("#span"+toTitleCase(e)+"SoldItems").html(window.crowdfundingStats[e].solditems),$("#span"+toTitleCase(e)+"TotalAvailable").html(window.crowdfundingStats[e].itemstotalavailable),$("#span"+toTitleCase(e)+"Delivery").html(window.crowdfundingStats[e].delivery),$("#span"+toTitleCase(e)+"Description").html(window.crowdfundingStats[e].description),$("#specialDeliveryAmount"+toTitleCase(e)+"Urgent").html(window.crowdfundingStats[e].urgent),$("#specialDeliveryAmount"+toTitleCase(e)+"Certified").html(window.crowdfundingStats[e].certified),$("#div"+toTitleCase(e)+"customDonationAmount").attr("min",window.crowdfundingStats[e].price),$("#div"+toTitleCase(e)+"customDonationAmount").attr("title","Introduce una cantidad mayor de €"+window.crowdfundingStats[e].price+".00");var t=parseInt(window.crowdfundingStats[e].price,10)+10;$("#div"+toTitleCase(e)+"customDonationAmount").attr("placeholder","p.ej. €"+t)}}function facebookShare(e){var t=e.id;FB.ui({method:"feed",link:"https://www.facebook.com/estonoesunaescuela/videos/1015089978618765/",caption:"Gracias por compartir este vídeo",source:"http://vimeo.com/user25782127/transformemos-la-escuela/",description:"Hasta el 6 de enero puedes participar en el sorteo de una ilustración original"},function(e){return function(t){hasBeenShared(t,e)}}(t))}function hasBeenShared(e,t){var n=$("#"+t).closest(".perkSocial").attr("id"),i=$("#"+n).siblings(".perkRaffle").attr("id"),o=$("#"+t).closest(".perkNetworks").attr("id"),a=$("#"+o).siblings(".perkNetError").attr("id");e?($("#"+n).hide(),$("#"+i).show(),window.amount>=minAmountRaffle&&(window.beenShared=!0)):($("#"+o).hide(),$("#"+a).show())}function mailChimper(e){var t="https://script.google.com/macros/s/AKfycbwG-vdUup2QUNsU5uH4QjRN9PJyXriwLiXvrwS_YpMQqBY1-8VR/exec",n="email_address="+e.eMail+"&localizer="+e.localizer+"&amount="+e.amount+"&perkID="+e.perkID,i=window.btoa(unescape(encodeURIComponent(n))),n={e:i};$.ajax({type:"post",url:t,jsonpCallback:"updateMailChimp",dataType:"jsonp",data:n})}function toTitleCase(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function closeWaitDiv(e){e="#"+e,$(e).hide()}function perkBlocksReset(e){window.perkToggleState&&($("#"+e).find("#"+window.perkToggleButton).trigger("click"),$("#"+e).find("#"+window.perkToggleButton).html("Leer más")),$("#"+e).find(".perkRaffle").hide(),$("#"+e).find(".perkCustomDonationAmount").hide(),$("#"+e).find(".perkPreFlight").hide(),$("#"+e).find(".perkPostFlight").hide(),parseInt($("#"+e).find(".perkCustomDonationAmount").attr("min"),10)>=minAmountRaffle&&raffleInProgress?$("#"+e).find(".perkSocial").show():$("#"+e).find(".perkSocial").hide(),$("#"+e).find(".perkNetError").hide(),$("#"+e).find(".perkCustomButton").html("Seleccionar"),$("#"+e).find(".perkDelivery").css("border-bottom","none"),$("#"+e).find(".perkButton").css("display","none"),$("#"+e).find(".perkToggle").css("pointer-events","none"),$("#"+e).find(".perkSelect").css("display","block"),$("#"+e).find(".specialDelivery").hide()}function perkAccordion(e){var t=$("#"+e).siblings();t.css("border","none"),t.css("box-shadow","none"),t.each(function(e){perkBlocksReset($(this).attr("id"))})}function close(){0==window.perkTokenBeenCalled&&$(".perkWait").hide()}function trustParser(){var e="1-X6Qag93mSiGUHNXpm4TzxAPU1TNKHa9eYLaA75LVRc",t="https://spreadsheets.google.com/feeds/list/"+e+"/od6/public/basic?alt=json",n=new XMLHttpRequest;n.open("GET",t,!0),n.send(),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){for(var e=JSON.parse(n.responseText),t="",i=e.feed.entry.length,o=0;o<i;o++){var a=e.feed.entry[o].content.$t,r=a.search("xcargo");if(r>-1){var d=a.split(", xcita: "),s=d[0];s=s.replace("xcargo:","");var c=d[1]}else s="",c=a.replace("xcita:","");t+='<div class = "cfTrustItem"><p class = "eneueName">'+e.feed.entry[o].title.$t+'</p><p class = "eneuePosition">'+s+'</p><p class = "eneueQuote">'+c+"</p></div>"}document.getElementById("cfTrustContainer1").innerHTML=t,$(".cfTrustContainer").slick({autoplay:!0,autoplaySpeed:8e3,infinite:!0,slidesToShow:1,fade:!0})}else if(4==n.readyState&&200!==n.status){var p='<iframe src="http://eneue.github.io/resources/trust.html" frameborder="0"></iframe>';document.getElementById("#cfTrustContainer1").innerHTML=p}}}function getCrowdfundingStats(){var e="1EFRGuZXSTLaGgTqG0Md7DTICMjXBH_2FSGmWIKsP7kg",t="https://spreadsheets.google.com/feeds/list/"+e+"/od6/public/basic?alt=json",n=new XMLHttpRequest;return n.open("GET",t,!0),n.send(),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText);window.crowdfundingStats=new Object;for(var t=e.feed.entry.length,i=0;i<t;i++){for(var o=e.feed.entry[i].content.$t,a=e.feed.entry[i].title.$t,r=o.split(","),d=new Object,s=r.length,c=0;c<s;c++){var p=r[c],l=p.split(":"),u=l[0],w=l[1];d[u.trim()]=w.trim()}window.crowdfundingStats[a]=d}statsInit()}},n}var cfstatsHttpResponse=getCrowdfundingStats(),minAmountRaffle=45,raffleInProgress=!1;$(document).ready(function(){$("#cfCTA1").css({top:"100px"}),window.ytfwidth=$("#cfPlayerFrame1").width(),youTubeResize("cfPlayer1",window.ytfwidth),window.ytfheight=$("#cfPlayerFrame1").width(),trustParser();var e="estonoesunaescuelaorg";!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}(),console.log("before initialization of flags"),window.perkTokenBeenCalled=!1,window.perkButtonEnd=!1,window.beenShared=!1,window.perkToggleState=null,console.log("after initialization of flags"),$(".perkSocial").hide(),console.log("after perkSocial hide")}),$(document).ajaxSuccess(function(e,t,n){switch(n.url){case"https://raw.githubusercontent.com/ENEUE/eneue.github.io/gh/presupuesto.js":budgetSuccess(t);break;default:statsInit()}}),raffleInProgress&&(window.twttr=function(e,t,n){var i,o=e.getElementsByTagName(t)[0],a=window.twttr||{};return e.getElementById(n)?a:(i=e.createElement(t),i.id=n,i.src="https://platform.twitter.com/widgets.js",o.parentNode.insertBefore(i,o),a._e=[],a.ready=function(e){a._e.push(e)},a)}(document,"script","twitter-wjs"),twttr.ready(function(e){e.events.bind("tweet",function(e){var t=e.target.parentElement.id;hasBeenShared(!0,t)})}),window.fbAsyncInit=function(){FB.init({appId:"994194617270624",xfbml:!0,version:"v2.4"})},function(e,t,n){var i,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(i=e.createElement(t),i.id=n,i.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(i,o))}(document,"script","facebook-jssdk"),$(".perkFacebook").on("click",function(){facebookShare(this)})),$("#cfTabsContainer1").tabs({heightStyle:"content",collapsible:!1,active:0}),$("#cfFAQs1").accordion({heightStyle:"content",collapsible:!0,active:!1,icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}}),$(".specialDelivery").find("input").change(function(){var e,t=$(this).val(),n=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").val(),10),i=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").attr("min"),10);e="CERTIFICADO"==t?window.certifiedAmount:window.urgentAmount,"CERTIFICADO"==t&&1==$(this).prop("checked")?$("#"+window.containerID).find("input[name=urgent]").attr("disabled",!1):"CERTIFICADO"==t&&0==$(this).prop("checked")&&(1==$("#"+window.containerID).find("input[name=urgent]").prop("checked")&&(e+=window.urgentAmount),$("#"+window.containerID).find("input[name=urgent]").prop("checked",!1),$("#"+window.containerID).find("input[name=urgent]").attr("disabled",!0)),1==$(this).prop("checked")?(window[t]=!0,i=Math.round(100*(i+e))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").attr("min",i),n=Math.round(100*(n+e))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").val(n)):(window[t]=!1,i=Math.round(100*(i-e))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").attr("min",i),n=Math.round(100*(n-e))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").val(n))}),$(".perkDisregard").on("click",function(){$(this).parent().hide()}),$(".perkDesc .perkToggle span").on("click",function(){window.perkToggleButton=$(this).attr("id"),window.perkToggleState=!window.perkToggleState;var e,t,n,i,o;return o=0,i=54,e=$(this),$p=e.parent(),t=$p.parent(),n=t.height(),n==i?($elems=t.children(),$last=$elems.last(),$elems.each(function(){o+=$(this).outerHeight()}),t.css({height:t.height()}).animate({height:o}),e.html("Leer menos"),!1):(t.css({height:n}).animate({height:i}),e.html("Leer mas"),!1)}),$(".divPerkErrorTry").click(function(){$(this).parent().hide(),$(this).parent().siblings(".perkNetworks").show()});var handler=StripeCheckout.configure({key:"pk_live_uWo17rHYl0BXyyKmoMtHM3aS",image:"https://estonoesunaescuela.squarespace.com/s/anagrama_peq_color_whitebckgrnd_small.png",locale:"auto",currency:"EUR",zipCode:!0,shippingAddress:!0,billingAddress:!1,panelLabel:"Dona {{amount}}",allowRememberMe:!1,token:function(e,t){window.perkTokenBeenCalled=!0;var n="https://script.google.com/macros/s/AKfycbywnXbEp_nIPvClMVyEgw_YK_IhHgqnAs9-N-sYVjufx1jPCLw/exec",i="stripeEmail="+e.email+"&stripeToken="+e.id+"&amount="+window.amountCents+"&itemID="+window.perkCode+"&beenShared="+window.beenShared+"&islive="+e.livemode+"&isCertified="+window.CERTIFICADO+"&isUrgent="+window.URGENTE,o=window.btoa(unescape(encodeURIComponent(i))),i={e:o},a=$.ajax({type:"get",url:n,jsonpCallback:"callback",contentType:"application/json",dataType:"jsonp",data:i});a.done(function(e){$("#"+window.containerID).find(".perkRaffle").hide(),$("#"+window.containerID).find(".perkCustomDonationAmount").hide(),$("#"+window.containerID).find(".perkPreFlight").hide();var t=new Date,n=t.toLocaleDateString(),i=t.toLocaleTimeString(),o="El día "+n+" a las "+i;if(beenHacked=e.beenHacked,beenHacked)$("#"+window.containerID).find(".divPerkResponse").html("Se ha producido un error en el servidor. Inténtelo más tarde.");else{window.amountR=e.amount/100,window.last4=e.last4,window.eMail=e.eMail,window.localizer=e.localizer,$("#"+window.containerID).find(".perkAmountShow").html(window.amountR),$("#"+window.containerID).find(".perkUlt4Show").html(window.last4),$("#"+window.containerID).find(".perkEmailShow").html(window.eMail),$("#"+window.containerID).find(".perkLocalizerShow").html(window.localizer),$("#"+window.containerID).find(".perkDate").html(o);var a="<br>No has concursado en la rifa";if(e.numRaffle)var a="<br>"+e.numRaffle;$("#"+window.containerID).find(".perkNumRaffleShow").html(a),$("#"+window.containerID).find(".perkWait").hide(),$("#"+window.containerID).find(".specialDelivery").hide(),window.perkTokenBeenCalled=!1,window.perkButtonEnd=!0,window.beenShared=!1,$("#"+window.containerID).find(".perkCustomButton").html("Finalizar"),$("#"+window.containerID).find(".perkPostFlight").show(),mailChimper(e)}})}});$(".perkCustomButton").click(function(e){$("#"+window.containerID).find(".perkSocial").hide();var t=$("#"+containerID).find(".specialDelivery"),n=t.find("input[name=certified]"),i=t.find("input[name=urgent]"),o=$("#"+window.containerID).find(".perkCustomDonationAmount").attr("id"),a=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").attr("min"),10);parseInt($("#"+o).val(),10)<a&&$("#"+o).val(a),0==window.perkButtonEnd?(window.isCertified=n.is(":checked"),window.isUrgent=i.is(":checked"),window.perkCode=$("#"+window.containerID).attr("name"),window.amount=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").val(),10),window.amountCents=100*window.amount,handler.open({name:"@noesunaescuela",description:window.crowdfundingStats[window.perkCode].description,amount:window.amountCents}),$("#"+window.containerID).find(".perkWait").show()):1==window.perkButtonEnd&&(perkBlocksReset(window.containerID),window.perkButtonEnd=!1)}),$(".perkSelect").click(function(){window.containerID=$(this).parents(".perkContenedor").attr("id"),window.perkCode=$("#"+window.containerID).attr("name"),window.certifiedAmount=parseFloat(window.crowdfundingStats[window.perkCode].certified,10),window.urgentAmount=parseFloat(window.crowdfundingStats[window.perkCode].urgent,10),window.CERTIFICADO=!1,window.URGENTE=!1,perkAccordion(window.containerID),$("#"+window.containerID).css("border","2px solid #AB0096"),$("#"+window.containerID).css("box-shadow","2px 2px 8px 1px #766896"),$("#"+containerID).find(".specialDelivery").show(),$("#"+containerID).find(".specialDelivery").find("input").each(function(){$(this).prop("checked",!1)}),$("#"+containerID).find(".specialDelivery").find("input[name=urgent]").attr("disabled",!0),$("#"+window.containerID).find(".perkCustomDonationAmount").attr("min",parseFloat(window.crowdfundingStats[window.perkCode].price,10)),$("#"+window.containerID).find(".perkCustomDonationAmount").val(parseFloat(window.crowdfundingStats[window.perkCode].price)),$("#"+window.containerID).find(".perkCustomDonationAmount").on("input",function(){var e=$(this).val();raffleInProgress&&parseInt(e,10)>=minAmountRaffle?$("#"+window.containerID).find(".perkSocial").show():$("#"+window.containerID).find(".perkSocial").hide()}),window.amount=$(this).siblings(".perkSend").find(".perkCustomDonationAmount").val(),raffleInProgress&&parseInt(window.amount,10)>=minAmountRaffle&&$("#"+window.containerID).find(".perkSocial").show(),$("#"+window.containerID).find(".perkToggle").css("pointer-events","auto"),$(".perkContenedor").css("height","auto"),$(this).css("display","none"),$(this).parent().find(".perkCustomButton").html("Continuar"),$(this).parent().find(".perkDelivery").css("border-bottom","dashed 1px lightgrey"),$(this).parent().find(".perkCustomDonationAmount").css("display","block"),$(this).parent().find(".perkCustomButton").show("blind",{easing:"easeInOutSine",duration:500}),$(this).parent().find(".perkCustomDonationAmount").show("blind",{easing:"easeInOutSine",duration:500}),$(this).parent().find(".perkPreFlight").show("blind",{easing:"easeInOutSine",duration:500})}),$(".perkSelect").hover(function(){var e=$(this).parent().css("height"),t=$(this).parent().css("width");$(this).css("height",e),$(this).css("width",t)}),$(window).on("popstate",function(){handler.close()}),$(document).on("DOMNodeRemoved",".stripe_checkout_app",close);var url_gauge="https://raw.githubusercontent.com/ENEUE/eneue.github.io/gh/presupuesto.js";$.ajax({type:"GET",dataType:"text",crossDomain:!0,url:url_gauge});