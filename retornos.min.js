function getCrowdfundingStats(){var n=new XMLHttpRequest;return n.open("GET","https://spreadsheets.google.com/feeds/list/1EFRGuZXSTLaGgTqG0Md7DTICMjXBH_2FSGmWIKsP7kg/od6/public/basic?alt=json",!0),n.send(),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText);window.crowdfundingStats=new Object;for(var t=e.feed.entry.length,o=0;o<t;o++){for(var i=e.feed.entry[o].content.$t,a=e.feed.entry[o].title.$t,r=i.split(","),d=new Object,s=r.length,w=0;w<s;w++){var c=r[w].split(":"),l=c[0],u=c[1];d[l.trim()]=u.trim()}window.crowdfundingStats[a]=d}statsInit()}},n}function statsInit(){$("#cfStatsAchieved1").html(window.crowdfundingStats.TOTALS.totalincome),$("#cfStatsSupporters1").html(window.crowdfundingStats.TOTALS.solditems),$("#cfStatsNeeded1").html(window.crowdfundingStats.TOTALS.optimal),$("#cfStatsDaysLeft1").html(window.crowdfundingStats.TOTALS.daysleft);for(var n in window.crowdfundingStats)if("PERK"==n.substring(0,4)){window.crowdfundingStats[n];$("#div"+toTitleCase(n)+"customDonationAmount").val(window.crowdfundingStats[n].price),$("#span"+toTitleCase(n)+"Price").html(window.crowdfundingStats[n].price),$("#span"+toTitleCase(n)+"SoldItems").html(window.crowdfundingStats[n].solditems),$("#span"+toTitleCase(n)+"TotalAvailable").html(window.crowdfundingStats[n].itemstotalavailable),$("#span"+toTitleCase(n)+"Delivery").html(window.crowdfundingStats[n].delivery),$("#span"+toTitleCase(n)+"Description").html(window.crowdfundingStats[n].description),$("#specialDeliveryAmount"+toTitleCase(n)+"Urgent").html(window.crowdfundingStats[n].urgent),$("#specialDeliveryAmount"+toTitleCase(n)+"Certified").html(window.crowdfundingStats[n].certified),$("#div"+toTitleCase(n)+"customDonationAmount").attr("min",window.crowdfundingStats[n].price),$("#div"+toTitleCase(n)+"customDonationAmount").attr("title","Introduce una cantidad mayor de €"+window.crowdfundingStats[n].price+".00");var e=parseInt(window.crowdfundingStats[n].price,10)+10;$("#div"+toTitleCase(n)+"customDonationAmount").attr("placeholder","p.ej. €"+e)}showGauge(0,window.crowdfundingStats.TOTALS.optimal,window.crowdfundingStats.TOTALS.daysleft,window.crowdfundingStats.TOTALS.totalincome,"perks-gauge1")}function facebookShare(n){var e=n.id;FB.ui({method:"feed",link:"https://www.facebook.com/estonoesunaescuela/videos/1015089978618765/",caption:"Gracias por compartir este vídeo",source:"http://vimeo.com/user25782127/transformemos-la-escuela/",description:"Hasta el 6 de enero puedes participar en el sorteo de una ilustración original"},function(n){return function(e){hasBeenShared(e,n)}}(e))}function hasBeenShared(n,e){var t=$("#"+e).closest(".perkSocial").attr("id"),o=$("#"+t).siblings(".perkRaffle").attr("id"),i=$("#"+e).closest(".perkNetworks").attr("id"),a=$("#"+i).siblings(".perkNetError").attr("id");n?($("#"+t).hide(),$("#"+o).show(),window.amount>=minAmountRaffle&&(window.beenShared=!0)):($("#"+i).hide(),$("#"+a).show())}function toTitleCase(n){return n.replace(/\w\S*/g,function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()})}function closeWaitDiv(n){n="#"+n,$(n).hide()}function perkBlocksReset(n){$("#"+n).find(".perkRaffle").hide(),$("#"+n).find(".perkCustomDonationAmount").hide(),$("#"+n).find(".perkPostFlight").hide(),parseInt($("#"+n).find(".perkCustomDonationAmount").attr("min"),10)>=minAmountRaffle&&raffleInProgress?$("#"+n).find(".perkSocial").show():$("#"+n).find(".perkSocial").hide(),$("#"+n).find(".perkCustomButton").hide(),$("#"+n).find(".perkBody").css("border-bottom","none"),$("#"+n).find(".perkToggle").css("pointer-events","none"),$("#"+n).find(".specialDelivery").hide()}function perkAccordion(n){var e=$("#"+n).siblings();e.css("border","none"),e.css("box-shadow","none"),e.each(function(n){perkBlocksReset($(this).attr("id"))})}function close(){0==window.perkTokenBeenCalled&&$(".perkWait").hide()}function showGauge(n,e,t,o,i){new JustGage({id:i,value:Math.round(o),min:Math.round(n),max:Math.round(e),title:"Obtenido",label:"quedan "+t+" días",symbol:"€",gaugeWidthScale:.2,levelColors:["#B51A41","#F59827","#AFE826"],titleMinFontSize:25})}function mailChimper(n){var e="email_address="+n.eMail+"&localizer="+n.localizer+"&amount="+n.amount+"&perkID="+n.perkID,e={e:window.btoa(unescape(encodeURIComponent(e)))};$.ajax({type:"post",url:"https://script.google.com/macros/s/AKfycbwG-vdUup2QUNsU5uH4QjRN9PJyXriwLiXvrwS_YpMQqBY1-8VR/exec",jsonpCallback:"updateMailChimp",dataType:"jsonp",data:e})}var cfstatsHttpResponse=getCrowdfundingStats(),minAmountRaffle=45,raffleInProgress=!1;$(document).ready(function(){statsInit(),$("#cfFAQs1").accordion({heightStyle:"content",collapsible:!0,active:!1,icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}}),window.perkTokenBeenCalled=!1,window.perkButtonEnd=!1,window.beenShared=!1,window.perkToggleState=null,$(".perkSocial").hide()}),raffleInProgress&&(window.twttr=function(n,e,t){var o,i=n.getElementsByTagName(e)[0],a=window.twttr||{};return n.getElementById(t)?a:(o=n.createElement(e),o.id=t,o.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(o,i),a._e=[],a.ready=function(n){a._e.push(n)},a)}(document,"script","twitter-wjs"),twttr.ready(function(n){n.events.bind("tweet",function(n){hasBeenShared(!0,n.target.parentElement.id)})}),window.fbAsyncInit=function(){FB.init({appId:"994194617270624",xfbml:!0,version:"v2.4"})},function(n,e,t){var o,i=n.getElementsByTagName(e)[0];n.getElementById(t)||((o=n.createElement(e)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk"),$(".perkFacebook").on("click",function(){facebookShare(this)})),$(".specialDelivery").find("input").change(function(){var n,e=$(this).val(),t=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").val(),10),o=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").attr("min"),10);n="CERTIFICADO"==e?window.certifiedAmount:window.urgentAmount,"CERTIFICADO"==e&&1==$(this).prop("checked")?$("#"+window.containerID).find("input[name=urgent]").attr("disabled",!1):"CERTIFICADO"==e&&0==$(this).prop("checked")&&(1==$("#"+window.containerID).find("input[name=urgent]").prop("checked")&&(n+=window.urgentAmount),$("#"+window.containerID).find("input[name=urgent]").prop("checked",!1),$("#"+window.containerID).find("input[name=urgent]").attr("disabled",!0)),1==$(this).prop("checked")?(window[e]=!0,o=Math.round(100*(o+n))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").attr("min",o),t=Math.round(100*(t+n))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").val(t)):(window[e]=!1,o=Math.round(100*(o-n))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").attr("min",o),t=Math.round(100*(t-n))/100,$("#"+window.containerID).find(".perkCustomDonationAmount").val(t))}),$(".perkDisregard").on("click",function(){$(this).parent().hide()}),$(".divPerkErrorTry").click(function(){$(this).parent().hide(),$(this).parent().siblings(".perkNetworks").show()});var handler=StripeCheckout.configure({key:"pk_live_uWo17rHYl0BXyyKmoMtHM3aS",image:"https://estonoesunaescuela.squarespace.com/s/anagrama_peq_color_whitebckgrnd_small.png",locale:"auto",currency:"EUR",zipCode:!0,shippingAddress:!0,billingAddress:!1,panelLabel:"Dona {{amount}}",allowRememberMe:"false",token:function(n,e){window.perkTokenBeenCalled=!0;var t="stripeEmail="+n.email+"&stripeToken="+n.id+"&amount="+window.amountCents+"&itemID="+window.perkCode+"&beenShared="+window.beenShared+"&islive="+n.livemode+"&isCertified="+window.CERTIFICADO+"&isUrgent="+window.URGENTE,t={e:window.btoa(unescape(encodeURIComponent(t)))};$.ajax({type:"get",url:"https://script.google.com/macros/s/AKfycbywnXbEp_nIPvClMVyEgw_YK_IhHgqnAs9-N-sYVjufx1jPCLw/exec",jsonpCallback:"callback",contentType:"application/json",dataType:"jsonp",data:t}).done(function(n){$("#"+window.containerID).find(".perkRaffle").hide(),$("#"+window.containerID).find(".perkCustomDonationAmount").hide(),$("#"+window.containerID).find(".perkPreFlight").hide();var e=new Date,t="El día "+e.toLocaleDateString()+" a las "+e.toLocaleTimeString();if(beenHacked=n.beenHacked,beenHacked)$("#"+window.containerID).find(".divPerkResponse").html("Se ha producido un error en el servidor. Inténtelo más tarde.");else{window.amountR=n.amount/100,window.last4=n.last4,window.eMail=n.eMail,window.localizer=n.localizer,$("#"+window.containerID).find(".perkAmountShow").html(window.amountR),$("#"+window.containerID).find(".perkUlt4Show").html(window.last4),$("#"+window.containerID).find(".perkEmailShow").html(window.eMail),$("#"+window.containerID).find(".perkLocalizerShow").html(window.localizer),$("#"+window.containerID).find(".perkDate").html(t);o="<br>No has concursado en la rifa";if(n.numRaffle)var o="<br>"+n.numRaffle;$("#"+window.containerID).find(".perkNumRaffleShow").html(o),$("#"+window.containerID).find(".perkWait").hide(),$("#"+window.containerID).find(".specialDelivery").hide(),window.perkTokenBeenCalled=!1,window.perkButtonEnd=!0,window.beenShared=!1,$("#"+window.containerID).find(".perkCustomButton").html("Finalizar"),$("#"+window.containerID).find(".perkPostFlight").show(),mailChimper(n)}})}});$(".perkCustomButton").click(function(n){$("#"+window.containerID).find(".perkSocial").hide();var e=$("#"+containerID).find(".specialDelivery"),t=e.find("input[name=certified]"),o=e.find("input[name=urgent]"),i=$("#"+window.containerID).find(".perkCustomDonationAmount").attr("id"),a=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").attr("min"),10);parseInt($("#"+i).val(),10)<a&&$("#"+i).val(a),0==window.perkButtonEnd?(window.isCertified=t.is(":checked"),window.isUrgent=o.is(":checked"),window.perkCode=$("#"+window.containerID).attr("name"),window.amount=parseFloat($("#"+window.containerID).find(".perkCustomDonationAmount").val(),10),window.amountCents=100*window.amount,handler.open({name:"@noesunaescuela",description:window.crowdfundingStats[window.perkCode].description,amount:window.amountCents}),$("#"+window.containerID).find(".perkWait").show()):1==window.perkButtonEnd&&(perkBlocksReset(window.containerID),window.perkButtonEnd=!1)}),$(".perkRadio").click(function(n){$(".perkSend").hide(),$(".perkPostFlight").hide(),$(".perkCustomButton").hide(),$(".perkBody").css("border-bottom","none"),window.containerID=n.currentTarget.attributes._parent.value,$("#"+window.containerID).siblings().css("border","none"),$("#"+window.containerID).siblings().css("box-shadow","none"),$("#"+window.containerID).css("border","2px solid #AB0096"),$("#"+window.containerID).css("box-shadow","2px 2px 8px 1px #766896"),window.perkCode=$("#"+window.containerID).attr("name"),window.certifiedAmount=parseFloat(window.crowdfundingStats[window.perkCode].certified,10),window.urgentAmount=parseFloat(window.crowdfundingStats[window.perkCode].urgent,10),window.CERTIFICADO=!1,window.URGENTE=!1,perkAccordion(window.containerID),$("#"+containerID).find(".specialDelivery").show(),$("#"+containerID).find(".specialDelivery").find("input").each(function(){$(this).prop("checked",!1)}),$("#"+containerID).find(".specialDelivery").find("input[name=urgent]").attr("disabled",!0),$("#"+window.containerID).find(".perkCustomDonationAmount").attr("min",parseFloat(window.crowdfundingStats[window.perkCode].price,10)),$("#"+window.containerID).find(".perkCustomDonationAmount").val(parseFloat(window.crowdfundingStats[window.perkCode].price)),$("#"+window.containerID).find(".perkCustomDonationAmount").on("input",function(){var n=$(this).val();raffleInProgress&&parseInt(n,10)>=minAmountRaffle?$("#"+window.containerID).find(".perkSocial").show():$("#"+window.containerID).find(".perkSocial").hide()}),window.amount=$("#"+window.containerID).find(".perkCustomDonationAmount").val(),$(".perkContenedor").css("height","auto"),raffleInProgress&&parseInt(window.amount,10)>=minAmountRaffle&&$("#"+window.containerID).find(".perkSocial").show(),$("#"+window.containerID).find(".perkCustomButton").html("Continuar"),$("#"+window.containerID).find(".perkBody").css("border-bottom","dashed 1px lightgrey"),$("#"+window.containerID).find(".perkCustomDonationAmount").css("display","block"),$("#"+window.containerID).find(".perkCustomButton").show(),$("#"+window.containerID).find(".perkCustomDonationAmount").show(),$("#"+window.containerID).find(".perkSend").show(),$("#"+window.containerID).find(".perkPreFlight").show()}),$(window).on("popstate",function(){handler.close()}),$(document).on("DOMNodeRemoved",".stripe_checkout_app",close),$(document).ready(function(){$(".eneue-return-link").click(function(){return parent.history.back(),!1})});